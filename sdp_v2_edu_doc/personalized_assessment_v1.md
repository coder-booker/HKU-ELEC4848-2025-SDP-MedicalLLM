# 学生个人化评估：从"数据"到"画像与建议"

## 核心目标

在前两个小节中，我们已经建立了"临床推理六步框架"与"标准化LLM评分工作流"。这两套工具会为每个学生生成**大量多维度、跨任务的定量数据**（例如过去10个病例中的各步骤评分、每次评分的理由文本等）。

然而，**仅有分数和图表是不够的**。评分的最终目的应该是**帮助学生理解自己的临床推理风格，识别稳定的强项与短板，获得可执行的改进建议**。

本小节的核心工作是：**设计一套数据管道，把这些原子化的评分数据聚合成一份结构化的、面向个人的"临床推理画像"与"学习建议"**。

---

## 一、原子数据来源与聚合策略

### 1.1 三类原子数据输入

系统会从以下三个来源收集原子级评分信号：

**1) 传统量表维度**
- CRI-HT-S（Focusing / Context Creation / Securing）——来自病史采集任务[308][316]
- Revised-IDEA（Interpretive Summary / Differential / Explanation / Alternatives）——来自临床文书[309]
- 各类OSCE、虚拟病人、口头汇报中的结构化评分维度

**2) 智能系统的行为与诊断**
- 虚拟病人系统中的交互日志：学生问诊顺序、检查选择、假设变更轨迹等[76][77]
- 错误模式：某学生在哪类病例上频繁遗漏哪类诊断、推理周期是否偏短/长等

**3) 本项目LLM-as-judge的输出**
- 每次评分的多维分数（过程分、结果分、五个维度各自的得分）
- 附带的文字理由与问题识别（例如"缺乏对dangerous diagnoses的觉察"）
- 置信度标记（高/中/低置信度）

### 1.2 按"推理步骤"聚合

系统不是简单地堆叠所有数据，而是按你定义的六步框架做第一层聚合。例如，对于某个学生的"假设生成（DDx）步骤"：

```
DDx 步骤的聚合数据：
├─ 来自10个病例的LLM-as-judge评分
│  ├─ 过程分平均：3.2
│  ├─ 结果分平均：2.1
│  └─ 维度分解
│     ├─ completeness (广度)：3.0
│     ├─ appropriateness (合理性)：3.5
│     ├─ ranking quality (排序)：3.0
│     ├─ dangerous diagnosis coverage (危险诊断)：1.5 ⚠️
│     └─ confidence avg：0.82
├─ 错误模式（从LLM理由中提取）
│  ├─ 遗漏"主动脉夹层"：4次
│  ├─ 遗漏"肺栓塞"：2次
│  └─ 诊断排序不当：5次
└─ 对比同侪
   ├─ 你的avg process score：3.2
   ├─ 班级avg：3.5
   ├─ 你的 dangerous diagnosis coverage：1.5
   └─ 班级avg：2.8
```

这样做的好处是：**每个学生的"推理轮廓"变得清晰可比**。

### 1.3 纵向累积与趋势识别

系统在学期内收集这些聚合数据多次（例如每周一次、或每次作业后），形成时间序列：

```
学生 Alice 的 "问题表征" 步骤纵向数据：

周次 | 过程分 | 结果分 | 语义精度 | Summary质量 | 置信度 | 趋势
1    | 2.5   | 2.0   | 2.0     | 2.5        | 0.76  | ↗ 初始
2    | 2.8   | 2.3   | 2.2     | 2.8        | 0.81  | ↑
3    | 3.1   | 2.5   | 2.5     | 3.0        | 0.85  | ↑ 稳定改进
4    | 3.0   | 2.4   | 2.4     | 3.0        | 0.83  | → 平台期
```

通过这个轨迹，系统能够识别"Alice的问题表征在第2-3周有明显改进，但第4周开始停滞"。

---

## 二、LLM生成"临床推理画像"的工作流

### 2.1 画像输入：聚合数据 + 定义

LLM接收的输入是：

```json
{
  "student": "Alice",
  "aggregated_data": {
    "clinical_reasoning_steps": {
      "cue_acquisition": { "process_avg": 3.4, "result_avg": 3.2, ... },
      "problem_representation": { "process_avg": 3.0, "result_avg": 2.4, ... },
      "hypothesis_generation": { "process_avg": 3.2, "result_avg": 2.1, "dangerous_diagnosis_coverage": 1.5, ... },
      ...
    },
    "error_patterns": {
      "missed_diagnoses": [
        {"diagnosis": "主动脉夹层", "frequency": 4, "cases": [...]},
        {"diagnosis": "肺栓塞", "frequency": 2, "cases": [...]}
      ],
      "reasoning_errors": [...]
    },
    "peer_comparison": {
      "process_scores_by_step": {...},
      "percentile_ranking": {...}
    },
    "temporal_trends": {
      "problem_representation": [2.5, 2.8, 3.1, 3.0],
      "interpretation": "improving then plateau"
    }
  },
  "student_profile_definitions": {
    "reasoning_style_types": {
      "intuitive": "快速生成DDx但容易遗漏，推理过程不显式",
      "analytical": "系统地逐步思考，但耗时较长，有时过度分析",
      "hybrid": "根据病例复杂度灵活切换策略"
    }
  }
}
```

### 2.2 画像输出：多层次叙述

LLM的输出是一份**结构化的自然语言报告**，包含四部分：

#### Part A：推理风格定性（Reasoning Style Profile）

基于学生在各步骤的特征，LLM将其分类为某种推理风格：

```
你的推理风格：混合偏分析型（Analytical-Hybrid）

特征：
- 在信息采集阶段表现稳定（CRI-HT-S Focusing: 3.4/5），
  说明你倾向于有目标的提问而非漫无目的。
- 但在"问题表征"阶段，你常常试图在summary中包含过多细节
  （vs同侪平均用词更简洁），导致信息密度反而降低。
- 假设生成时，你的排序通常合理，但危险诊断的覆盖度明显低于同侪
  （你: 1.5/5, 班级平均: 2.8/5）。
- 最后在"假设评估"阶段，你显示出较强的自我反思意识
  （在4个案例中识别出"what doesn't fit"的问题），
  这是你的强项，也是专家型推理的标志。

解释：这种混合风格表明，你正在从"快速直觉"向"系统分析"
转变。你已经学会了显式化推理过程，但在某些方面（特别是
危险诊断觉察）仍需加强。
```

#### Part B：强项与短板地图（Strengths & Gaps Map）

聚焦前三个最突出的优点与三个最需改进的方面：

```
✅ 三大强项：

1. 自我反思与校准能力（Reflection & Calibration）
   - 在"what doesn't fit"识别上，你的表现在班级排名前30%
   - 这表明你能够自我检查并调整假设，是进阶推理的关键
   - 建议：继续保持这个优势，可进一步写出"哪些线索最坚决地
     排除了某个诊断"

2. 问诊聚焦性（Cue Acquisition - Focusing）
   - 平均得分3.4/5，高于班级平均3.0
   - 在危急病例中尤其表现好（平均在进行性症状的追问上得分高）

3. 临床术语准确性（Clinical Accuracy）
   - 在所有病例中，你使用的医学术语无明显错误
   - 提示你的基础医学知识较扎实

🔴 三个优先改进项：

1. ⚠️ 危险诊断觉察度（Dangerous Diagnosis Awareness）
   - 当前：1.5/5，班级平均：2.8/5
   - 具体表现：在4个胸痛病例中均未提及主动脉夹层；
     在2个腹痛病例中未提及肠穿孔
   - 风险等级：高（这类诊断遗漏直接威胁患者安全）
   - 原因分析：可能是"不够熟悉这些疾病的关键特征"或
     "缺乏"mortality check"的习惯"

2. 问题表征的信息密度（Problem Representation Efficiency）
   - Summary statements 平均92个词，同侪平均58个词
   - 虽然详细，但冗余信息占比约35%
   - 这可能导致后续DDx阶段触发过多无关假设
   - 改进空间：学习用"语义修饰符"（如"急性"vs"慢性"）
     而非罗列所有症状来压缩表述

3. 诊断排序的一致性（Ranking Coherence）
   - 在7个病例中，你给出的DDx排序与专家参考不一致（Spearman ρ=0.62, p<0.05）
   - 例如：患者"年轻、急性胸痛、无冠心病风险"，你排序为
     MI > PE > 气胸，而实际应为 PE > 气胸 > MI
   - 原因：可能过度重视"症状匹配度"而忽视"流行病学概率"
```

#### Part C：案例驱动的具体观察（Case-Specific Observations）

从LLM评分时生成的理由中，提取出关键观察——但**只列最有教学价值的2-3个**：

```
具体案例片段：

案例3（56岁女性，干咳2周，在ARB治疗中）：
- 你的答案：列出了"感染""慢阻肺"，但未提"药物副作用"
- 分析：这个案例中，ARB诱发咳嗽的可能性高于50%（特别是
  干咳+时间线对应），是首选诊断。但你在顺序上排在后面。
  这提示你在"用药史与副作用"的关联上可能需加强学习。
  → 建议：复习常见药物副作用速查表，特别是ACE-I/ARB

案例7（72岁男性，胸痛伴血压升高）：
- 你的答案：正确识别了"主动脉夹层"并排在首位
- 积极反馈：很好！说明在这个病例上你成功应用了之前学到的
  高危特征识别。这是改进的证据。
```

### 2.3 图表嵌入（可视化协助）

报告中嵌入2-3个简单图表，但**不过度可视化**：

```
你在六个推理步骤上的表现分布（相对于班级平均）：

     分数 ↑
     4.0 │                 ✓
     3.5 │     ✓   ✓   ✓       
     3.0 │─────────────────── 班级平均
     2.5 │           ✓       ⚠️
     2.0 │   ⚠️
     1.5 │
         └─────────────────────→
          线索 问题 假设 评估 反思
          获取 表征 生成 缩小 校准

你的"危险诊断覆盖度"纵向曲线：
     
     5.0 │ 班级平均 ・・・・・・
     4.0 │  ・
     3.0 │   ・
     2.8 │    ・・・・・・・・・ 班级平均
     2.0 │    
     1.5 │ ●●●●●● 你的得分 (一直未改进)
         └─────────────────────
         第1周  第2周  第3周  第4周
```

---

## 三、从画像到建议：行动清单

### 3.1 建议生成逻辑

LLM不是凭空生成建议，而是按以下逻辑：

1. **识别"最突出的短板"**（例如危险诊断覆盖度）
2. **在该短板与具体学习活动之间建立连接**
3. **给出可在1-4周内完成的具体任务**

### 3.2 短期建议（Next Week）

```
⏰ 本周行动建议（可在3-5小时内完成）：

优先级 1️⃣  —— 危险诊断快速掌握
├─ 任务：复习"急性胸痛决策树"中的 Rule-Out 顺序
├─ 资源：参考 Chest Pain Rulout Protocol（附在资源库中）
├─ 验证方式：完成3个"PE vs MI vs AD"的对比推理练习，
│           用LLM-as-judge自评一遍
└─ 预期产出：这周结束前，在胸痛类病例中"主动脉夹层"
            的识别率应达 >80%

优先级 2️⃣  —— 问题表征精简
├─ 任务：用"语义修饰符模板"重写上周的3个summary statement
├─ 模板例子：
│   原始：患者是56岁女性，有长期吸烟史，高血压，
│          最近三个月咳嗽，最近一周加重...
│   改进：56岁女性，在ARB用药期间出现2周干咳，
│         夜间加重，无全身症状。高血压，吸烟史。
├─ 目标：将平均词数从92 → 65以内
└─ 验证：自评这三份改进版本，观察是否更容易触发"正确的"
        初始DDx假设

次要 3️⃣  —— 可选深化（如果前两项进度快）
└─ 病例重做：选择上周表现差的2个病例重新分析，
   对比你的新答案与参考答案的排序
```

### 3.3 中期建议（This Semester）

```
📅 本学期持续跟踪与改进方向：

维度1：危险诊断觉察 → 个性化学习路径
├─ 基于你的错误模式（特别是遗漏"主动脉夹层""肺栓塞"），
│  建议聚焦心血管系统的高危诊断培养
├─ 周度任务：每周至少1个含有"致命但易遗漏"诊断的病例
├─ 目标：到学期末，危险诊断覆盖度从1.5 → 3.5以上
└─ 追踪指标：LLM每周自动计算你的覆盖度，如未改进会提醒教师

维度2：诊断排序的流行病学调整
├─ 根本问题：你目前过度依赖"症状匹配"，
│           欠缺"患者人口统计学+症状"的综合判断
├─ 学习方式：每两周进行1次"排序推理"练习
│           （给出同样症状，但患者背景不同，看排序如何变化）
└─ 工具：提供"流行病学先验概率表"供参考

维度3：强项深化 —— 反思能力的进阶使用
├─ 你在"what doesn't fit"识别上已经表现优异，
│  可进一步训练"多诊断假设共存"的情景
├─ 案例：患者既有"肺炎表现"又有"卡氏肺囊虫肺炎(PCP)线索"
│       时，如何并行考虑？
└─ 建议：挑选2-3个复杂病例做"多诊断管理"训练
```

### 3.4 未来可能的拓展方向

```
💡 超出本学期范围的潜在发展方向
  （如果跨学期追踪成为可能）

- 专科分化分析：观察你在"内科病例"vs"外科病例"
  之间的推理风格是否差异，并据此制定专科个性化建议

- 推理风格进化追踪：从当前的"分析-混合型"，
  观察你是否逐渐演化为"更expert-like的混合风格"
  （能快速+准确地识别主要诊断）

- 团队协作推理：如果引入多人协同推理场景，
  分析你的"假设提出"vs"假设验证"在小组中的贡献

这些方向不是本阶段的目标，但框架已经为之预留了数据接口。
```

---

## 四、系统实现的关键点

### 4.1 LLM Prompt 结构

生成画像的 prompt 需要包含以下几个section：

```
SYSTEM:
你是一位有10年医学教育经验的临床教育工作者。你的任务是
基于一个医学生的评估数据，生成一份个人化的"临床推理画像"
报告。报告应该：
1. 用自然语言解释数据，而非单纯列数字
2. 避免过度积极或过度消极的语气
3. 识别具体的可执行改进方向
4. 强调安全性相关的短板（如危险诊断遗漏）

---

CONTEXT:
[聚合数据JSON]

---

OUTPUT FORMAT:
你的输出应包含：
1. 推理风格定性（2-3段）
2. 强项与短板地图（6项，每项50-100词）
3. 案例驱动观察（2-3个具体例子）
4. JSON格式的建议清单：
   {"priority": 1-3, "domain": "...", "action": "...", 
    "timeframe": "1-4 weeks", "success_metric": "..."}
```

### 4.2 数据生成的自动化

```
每周自动流程：

1. 收集本周的所有学生评分记录
   ↓
2. 按"推理步骤"聚合数据（之前做过的）
   ↓
3. 计算与班级平均值的偏差、百分位数
   ↓
4. 提取LLM评分理由中的error patterns
   ↓
5. 生成纵向趋势（对比与上周/上月）
   ↓
6. 调用LLM生成个人化报告
   ↓
7. 系统在dashboard中展示给学生+教师
   ↓
8. 教师可选择推送至学生或标记为"待审查"
```

### 4.3 输出形态

报告有两个版本：

| 版本 | 受众 | 格式 | 长度 |
|------|------|------|------|
| **学生版** | 学生 | 自然语言 + 图表 + 可视化建议 | 1500-2000词 |
| **教师版** | 教师 + 教研人员 | 学生版 + 底层数据表 + 班级对比 | 2500-3500词 |

两个版本基于同一份聚合数据生成，但呈现方式和深度不同。

---

## 五、与前两个小节的贯通

```
临床推理教学框架（Gap 1）
    ↓
    定义了6步 + 2个评估维度
    
        ↓
        
LLM-as-Judge评估工作流（Gap 2）
    ↓
    在每一步每一维度上生成评分 + 理由
    
        ↓
        
个人化评估画像与建议（Gap 3）
    ↓
    把多次评分聚合、生成学生的"推理轮廓"
    + 定性风格分类
    + 可执行建议
    
        ↓
    
最终输出给学生与教师：
    清晰、可读、可行动的个性化报告
```

本节的贡献是确保**评估的最后一公里**——数据真正被转化为"对学生友好的洞察和行动指南"，而不是停留在分数与图表。这是**与传统ITS和纯评分系统的关键区别**，也是本项目在"学习评估深度"上的推进。
